# 快速使用教學

此專案需要一些第三方服務的 API Key，請先確保擁有以下帳戶。

## 必要帳戶

| 服務 | 用途 | 必填 |
|------|------|------|
| Discord Developer | Bot Token | 是 |
| Google AI Studio | Gemini API（兌換碼搜尋） | 否 |
| JSONBin.io | 雲端備份 UID 資料 | 否 |

---

## Token 獲取教學

### 1. Discord Bot Token

1. 前往 [Discord Developer Portal](https://discord.com/developers/applications)
2. 點擊 **New Application**，輸入名稱
3. 左側選單點擊 **Bot**
4. 點擊 **Reset Token** 取得 Token（只會顯示一次，請妥善保存）
5. 開啟以下選項：
   - **Presence Intent**
   - **Server Members Intent**
   - **Message Content Intent**
6. 左側選單點擊 **OAuth2 > URL Generator**
7. 勾選 `bot` 和 `applications.commands`
8. Bot Permissions 勾選：`Send Messages`、`Embed Links`、`Attach Files`、`Use Slash Commands`
9. 複製產生的 URL，在瀏覽器開啟並邀請 Bot 到你的伺服器

### 2. Discord Guild ID（伺服器 ID）

1. 開啟 Discord，進入 **使用者設定 > 進階**
2. 開啟 **開發者模式**
3. 右鍵點擊你的伺服器圖示
4. 點擊 **複製伺服器 ID**

### 3. Google Gemini API Key（選填）

1. 前往 [Google AI Studio](https://aistudio.google.com/)
2. 點擊 **Get API Key (左下角)**
3. 建立新的 API Key 或使用現有的
4. 複製 API Key

### 4. JSONBin.io（選填，雲端備份用）

1. 前往 [JSONBin.io](https://jsonbin.io/) 並註冊帳戶
2. 登入後，點擊右上角 **API Keys**
3. 複製你的 **X-Master-Key**
4. 建立一個新的 Bin：
   - 點擊 **Create a Bin**
   - 內容填入：`{"hsr": {}, "zzz": {}, "active": true}`
   - 點擊 **Create**
5. 複製 Bin ID

---

## 安裝與執行

### 步驟 1：下載專案

```bash
git clone https://github.com/your-username/Discord-AI-Bot.git
cd Discord-AI-Bot
```

### 步驟 2：設定環境變數

```bash
# 複製範例檔案
cp env.example .env
```

編輯 `.env` 檔案，填入你的 Token：

```env
# 必填
DISCORD_TOKEN='你的Discord_Bot_Token'
DISCORD_GUILD_ID='你的伺服器ID'

# 選填（兌換碼搜尋功能）
GEMINI_API_KEY='你的Gemini_API_Key'

# 選填（雲端備份功能）
JSONBIN_API_KEY='你的X-Master-Key'
JSONBIN_BIN_ID='你的Bin_ID'
```

> **重要**：所有值都要用單引號 `'` 包起來，因為某些 API Key 包含特殊字元（如 `$`），不加引號會導致 Docker Compose 解析錯誤。

### 步驟 3：執行（選擇一種方式）

**方式 A - Docker Compose（推薦）**

```bash
# 啟動（背景執行）
docker-compose up -d

# 查看 log
docker-compose logs -f

# 停止
docker-compose down
```

**方式 B - Docker**

```bash
# 建立 image（需要一段時間）
docker build -t discord-ai-bot .

# 執行
docker run -d --name my-bot --env-file .env discord-ai-bot

# 查看 log
docker logs -f my-bot

# 停止
docker stop my-bot
```

**方式 C - 本地開發（不使用 Docker）**

```bash
# 安裝 Node.js 依賴
npm install

# 安裝 Python 依賴（角色卡片生成用）
# 確保你有安裝 uv (https://docs.astral.sh/uv/)
cd python
uv sync
cd ..

# 執行
npm run dev
```

---

## 驗證安裝成功

1. 機器人上線後，在 Discord 輸入 `/ping`
2. 如果收到回應，表示安裝成功
3. 輸入 `/honkai-star-rail` 測試其他功能

---

## 常見問題

### Q: Bot 無法上線？

- 確認 `DISCORD_TOKEN` 正確
- 確認已開啟 **Message Content Intent**

### Q: 斜線指令沒有出現？

- 確認 `DISCORD_GUILD_ID` 正確
- 等待幾分鐘，Discord 有時需要時間同步

### Q: 兌換碼查詢失敗？

- 確認 `GEMINI_API_KEY` 正確
- 檢查 Gemini API 配額是否用完

### Q: 角色卡片生成失敗？

- 確認 Python 環境正確安裝
- 檢查 `starrailcard` 套件是否安裝
